/**
 * Validid is a Javascript library to validate ID card number of Hong Kong, Taiwan, South Korea and China.
 *
 * Validid is open source in:
 * https://github.com/Edditoria/validid
 *
 * Code released under the MIT license:
 * https://github.com/Edditoria/validid/blob/main/LICENSE.txt
 *
 * @author Edditoria <edditoria@pm.me>
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).validid={})}(this,(function(t){"use strict";function e(t){var e=/[-/\s]/g;return t=t.toUpperCase().replace(e,""),(e=/\([A-Z0-9]\)$/).test(t)&&(t=t.replace(/[()]/g,"")),t}function r(t){return/^[A-Z]$/.test(t)}function n(t,e){var r=+t.substring(0,4),n=+t.substring(4,6),i=+t.substring(6,8),a=+e.substring(0,4),s=+e.substring(4,6),o=+e.substring(6,8),u=a-r;return(s<n||s===n&&o<i)&&u--,u}function i(t){if("string"!=typeof t)return!1;if(8!==t.length)return!1;var e=t.substring(0,4),r=t.substring(4,6),n=t.substring(6,8),i=new Date(e+"-"+r+"-"+n);return!Number.isNaN(i.valueOf())}function a(t){if("string"!=typeof t)throw new TypeError("Input has to be string.");if(8!==t.length)throw new RangeError('Input has to be in format of "YYYYMMDD".');var e=t.substring(0,4),r=t.substring(4,6),n=t.substring(6,8),i=new Date(e+"-"+r+"-"+n);if(Number.isNaN(i.valueOf()))throw new Error("Invalid date.");return i}var s={code:0,text:"OK",desc:""},o={code:1,text:"UNKNOWN_ERROR",desc:""},u={code:2,text:"INVALID_LENGTH",desc:""},d={code:3,text:"INVALID_FORMAT",desc:""},c={code:4,text:"INVALID_DATE",desc:""},I={code:5,text:"INVALID_CHECKSUM",desc:""},l="ABCDEFGHJKLMNPQRSTUVXYWZIO",N=Object.freeze({NIC:"NIC",RC:"RC",INVALID:"INVALID"}),D=Object.freeze({NIC:"^[A-Z][12][0-9]{8}$",RC:"^[A-Z][89A-D][0-9]{8}$"}),f=Object.freeze({RC_2021:"RC_2021",RC_LEGACY:"RC_LEGACY",NOT_RC:"NOT_RC"}),A=Object.freeze({RC_2021:"^[A-Z][89][0-9]{8}$",RC_LEGACY:"^[A-Z][A-D][0-9]{8}$"}),g={OK:s,UNKNOWN_ERROR:o,INVALID_LENGTH:u,INVALID_FORMAT:d,INVALID_CHECKSUM:I};function p(t){return new RegExp(D.NIC).test(t)?N.NIC:new RegExp(D.RC).test(t)?N.RC:N.INVALID}function _(t){return new RegExp(A.RC_LEGACY).test(t)?f.RC_LEGACY:new RegExp(A.RC_2021).test(t)?f.RC_2021:f.NOT_RC}function v(t){for(var e=function(t,e){void 0===e&&(e=9);var r=l.indexOf(t[0]);return Math.floor(r/10+1)+r*e}(t)+function(t,e){void 0===e&&(e=8);var n=t[1];return(r(n)?+l.indexOf(n):+n)*e}(t),n=t.slice(2,-1),i=n.length,a=0,s=n;a<s.length;a+=1){e+=+s[a]*i,i--}return""+(10-e%10)%10}function C(t){var r=e(t),n="TWID",i=p(r);return 10!==r.length?{id:r,type:n,ok:!1,status:g.INVALID_LENGTH}:i===N.INVALID?{id:r,type:n,ok:!1,status:g.INVALID_FORMAT}:v(r)!==r.slice(-1)?{id:r,type:n,ok:!1,status:g.INVALID_CHECKSUM}:{id:r,type:n,ok:!0,status:g.OK}}var L="^[A-NP-Z]{1,2}[0-9]{6}[0-9A]$",R={OK:s,UNKNOWN_ERROR:o,INVALID_LENGTH:u,INVALID_FORMAT:d,INVALID_CHECKSUM:I};function E(t){return 8===t.length||9===t.length}function T(t){for(var e=t.length,n=8===e?324:0,i=0,a=t.slice(0,-1);i<a.length;i+=1){var s=a[i];n+=(r(s)?s.charCodeAt(0)-55:+s)*e,e--}var o=(11-n%11)%11;return 10===o?"A":""+o}function w(t){var r=e(t),n="HKID";return E(r)?new RegExp(L).test(r)?r.slice(-1)!==T(r)?{id:r,type:n,ok:!1,status:R.INVALID_CHECKSUM}:{id:r,type:n,ok:!0,status:R.OK}:{id:r,type:n,ok:!1,status:R.INVALID_FORMAT}:{id:r,type:n,ok:!1,status:R.INVALID_LENGTH}}var h="^[0-9]{13}$",V={OK:s,UNKNOWN_ERROR:o,INVALID_LENGTH:u,INVALID_FORMAT:d,INVALID_DATE:c,INVALID_CHECKSUM:I};function O(t){var e;switch(t.substring(6,7)){case"1":case"2":case"5":case"6":e="19";break;case"3":case"4":case"7":case"8":e="20";break;default:e="18"}var r=e+t.substring(0,6);if(!i(r))throw new Error("Invalid date");return r}function y(t){var r,i=e(t),a="KRID";if(13!==i.length)return{id:i,type:a,ok:!1,status:V.INVALID_LENGTH};if(!new RegExp(h).test(i))return{id:i,type:a,ok:!1,status:V.INVALID_FORMAT};try{r=O(i)}catch(s){return{id:i,type:a,ok:!1,status:V.INVALID_DATE}}return n(r,(new Date).toLocaleDateString("sv").replace(/-/g,""))<17?{id:i,type:a,ok:!1,status:V.INVALID_DATE}:{id:i,type:a,ok:!0,status:V.OK}}var k="^[0-9]{17}[0-9X]$",K={OK:s,UNKNOWN_ERROR:o,INVALID_LENGTH:u,INVALID_FORMAT:d,INVALID_DATE:c,INVALID_CHECKSUM:I};function H(t){var e=t.substring(6,14);if(!i(e))throw new Error("Invalid date");return e}function b(t){for(var e=t.slice(0,-1),r=0,n=t.length,i=0,a=e;i<a.length;i+=1){r+=+a[i]*(Math.pow(2,n-1)%11),n--}var s=(12-r%11)%11;return 10===s?"X":""+s}function M(t){var r,n=e(t),i="CNID";if(18!==n.length)return{id:n,type:i,ok:!1,status:K.INVALID_LENGTH};if(!new RegExp(k).test(n))return{id:n,type:i,ok:!1,status:K.INVALID_FORMAT};try{r=H(n)}catch(a){return{id:n,type:i,ok:!1,status:K.INVALID_DATE}}return+r>=+(new Date).toLocaleDateString("sv").replace(/-/g,"")?{id:n,type:i,ok:!1,status:K.INVALID_DATE}:b(n)!==n.slice(-1)?{id:n,type:i,ok:!1,status:K.INVALID_CHECKSUM}:{id:n,type:i,ok:!0,status:K.OK}}var m={normalize:function(t){return e(t)},isDateValid:function(t,e,r){var n,i,s;void 0===e&&(e="default"),void 0===r&&(r="today"),"default"!==e&&""!==e||(e="18991129");try{n=a(t),i=a(e)}catch(u){return!1}var o=new Date;if(n>o||i>o)return!1;if("today"===r)s=o;else if("string"==typeof r){try{s=a(r)}catch(d){return!1}if(s<o)return!1}else{if(!(r instanceof Date&&isFinite(r.getTime())))return!1;s=r}return n>=i&&n<=s},getMaxDate:function(t){var e=new Date,r=e.getFullYear()-t;return new Date(r,e.getMonth(),e.getDate())},isTwidChecksumValid:function(t,e){return v(t)===t.slice(-1)},getTwrcFormat:function(t){var e=_(t);return e===f.RC_2021?"new":e===f.RC_LEGACY&&"old"}};t.BIRTH_DATE_OF_OLDEST_CHINESE="18860625",t.CNID_LENGTH=18,t.CNID_PATTERN=k,t.CnidStatus=K,t.HKID_PATTERN=L,t.HkidStatus=R,t.KRID_LENGTH=13,t.KRID_MIN_AGE=17,t.KRID_PATTERN=h,t.KridStatus=V,t.TWID_LENGTH=10,t.TwidPattern=D,t.TwidStatus=g,t.TwidType=N,t.TwrcPattern=A,t.TwrcVersion=f,t.ValididResponse={},t.ValididStatus={},t.captureBirthDateFromCnid=H,t.captureBirthDateFromKrid=O,t.cnid=function(t){return console.warn("validid.cnid() is deprecated. Please contact developer to update the program."),M(t).ok},t.getAge=n,t.getCnidDigit=b,t.getHkidDigit=T,t.getKridDigit=function(t){for(var e=[2,3,4,5,6,7,8,9,2,3,4,5,1],r=0,n=0,i=0,a=t.slice(0,-1);i<a.length;i+=1){r+=+a[i]*e[n],n++}return((11-r%11)%10).toString()},t.getTwidDigit=v,t.hkid=function(t){return console.warn("validid.hkid() is deprecated. Please contact developer to update the program."),w(t).ok},t.identifyTwidType=p,t.identifyTwrcVersion=_,t.isCaptialLetter=r,t.krid=function(t){return console.warn("validid.krid() is deprecated. Please contact developer to update the program."),y(t).ok},t.normalize=e,t.statusDummyId={code:6,text:"DUMMY_ID",desc:""},t.statusInvalidChecksum=I,t.statusInvalidDate=c,t.statusInvalidFormat=d,t.statusInvalidLength=u,t.statusOk=s,t.statusUnknownError=o,t.twid=function(t){console.warn("validid.twid() is deprecated. Please contact developer to update the program.");var e=C(t);return e.ok&&p(e.id)===N.NIC},t.twrc=function(t){console.warn("validid.twrc() is deprecated. Please contact developer to update the program.");var e=C(t);return e.ok&&p(e.id)===N.RC},t.twrcLegacy=function(t){console.warn("validid.twrcLegacy() is deprecated. Please contact developer to update the program.");var e=C(t),r=_(e.id);return e.ok&&r===f.RC_LEGACY},t.utils=m,t.validateCnid=M,t.validateDateString=i,t.validateHkid=w,t.validateHkidLength=E,t.validateKrid=y,t.validateTwid=C}));
